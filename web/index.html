<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FRAI Fridge Dashboard</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="easy">
  <div class="background-blobs" aria-hidden="true">
    <div class="blob blob-a"></div>
    <div class="blob blob-b"></div>
    <div class="blob blob-c"></div>
  </div>

  <main class="page">
    <header class="hero" data-app-screen="home">
      <div class="brand-row">
        <div class="brand-mark" aria-hidden="true">
          <span class="brand-yolk"></span>
        </div>
        <div class="brand-copy">
          <p class="eyebrow" data-i18n="hero_eyebrow">FRAI MVP</p>
          <h1 data-i18n="hero_title">Fridge Control Board</h1>
          <p class="subtitle" data-i18n="hero_subtitle">Track ingredients, expiration risk, recipe options, and shopping actions in one place.</p>
        </div>
      </div>
      <div id="globalError" class="error-banner" hidden></div>
      <div class="controls">
        <label for="userId" class="advanced-only" data-i18n="label_user_id">User ID</label>
        <input id="userId" class="advanced-only" type="text" value="demo-user">
        <label for="languageSelect" data-i18n="label_language">Language</label>
        <select id="languageSelect">
          <option value="en">English</option>
          <option value="ko">Korean</option>
        </select>
        <label class="checkline mode-toggle">
          <input id="easyModeToggle" type="checkbox" checked>
          <span data-i18n="easy_mode_label">Easy Mode</span>
        </label>
        <button id="refreshAllBtn" class="btn" type="button" data-i18n="btn_refresh_all">Refresh All</button>
        <button id="reloadCatalogBtn" class="btn ghost" type="button" data-i18n="btn_reload_catalog">Reload Catalog</button>
        <span id="reloadCatalogResult" class="muted"></span>
      </div>

      <details class="api-details advanced-only">
        <summary data-i18n="remote_api_summary">Remote API (optional)</summary>
        <div class="form">
          <div class="inline-fields">
            <label>
              <span data-i18n="label_api_base_url">API Base URL</span>
              <input id="apiBaseUrl" type="text" placeholder="https://xxxx.trycloudflare.com">
            </label>
            <label>
              &nbsp;
              <button id="saveApiBaseBtn" class="btn ghost" type="button" data-i18n="btn_save">Save</button>
            </label>
          </div>
          <div class="inline-actions">
            <button id="clearApiBaseBtn" class="btn ghost" type="button" data-i18n="btn_use_same_origin">Use Same Origin</button>
          </div>
          <p class="muted" data-i18n-html="remote_api_help_html">Use this when the dashboard is hosted separately (e.g. Cloudflare Pages) and the API runs elsewhere (e.g. Tunnel). Enable CORS on the API server with <code>ENABLE_CORS=1</code>.</p>
        </div>
      </details>
    </header>

    <section class="grid one-col mobile-app-home" data-app-screen="home">
      <article class="card mobile-home-card" id="mobileHomeCard">
        <div class="mobile-status-bar" aria-hidden="true">
          <span class="time">9:41</span>
          <span class="icons">&#128246; &#128251; &#128267;</span>
        </div>
        <div class="mobile-home-head">
          <div class="mobile-home-icon" aria-hidden="true"><span class="mobile-home-yolk"></span></div>
          <h2 class="mobile-home-title">Frai</h2>
          <p class="mobile-home-subtitle">Frai가 냉장고를 정리해줄게요 &#128151;</p>
        </div>

        <p class="mobile-question">냉장고 재료를 어떻게 추가할까요?</p>

        <div class="mobile-primary-actions">
          <button id="hubTakePhotoBtn" class="mobile-action-btn primary" type="button">
            <span class="emoji" aria-hidden="true">&#128247;</span>
            <span class="txt">
              <strong>냉장고 사진 찍기</strong>
              <small>사진 한 장으로 재료를 바로 인식해요</small>
            </span>
          </button>
          <button id="hubTalkBtn" class="mobile-action-btn" type="button">
            <span class="emoji" aria-hidden="true">&#128172;</span>
            <span class="txt">
              <strong>대화로 추가하기</strong>
              <small>말하듯 입력하면 AI가 정리해드려요</small>
            </span>
          </button>
        </div>

        <div class="mobile-divider"><span>또는</span></div>
        <button id="hubExploreBtn" class="mobile-explore-btn" type="button">일단 둘러볼게요</button>

        <div class="mobile-feature-row">
          <button id="hubNotificationsBtn" class="feature-chip" type="button">
            <span aria-hidden="true">&#9200;</span>
            <span>유통기한 알림</span>
          </button>
          <button id="hubRecipesBtn" class="feature-chip" type="button">
            <span aria-hidden="true">&#127859;</span>
            <span>레시피 추천</span>
          </button>
          <button id="hubShoppingBtn" class="feature-chip" type="button">
            <span aria-hidden="true">&#128722;</span>
            <span>쇼핑 연결</span>
          </button>
        </div>
      </article>
    </section>

    <section class="grid stats-grid" data-app-screen="home">
      <article class="card stat">
        <h2 data-i18n="stat_total">Total</h2>
        <p id="statTotal" class="stat-value">0</p>
      </article>
      <article class="card stat">
        <h2 data-i18n="stat_fresh">Fresh</h2>
        <p id="statFresh" class="stat-value">0</p>
      </article>
      <article class="card stat">
        <h2 data-i18n="stat_expiring_soon">Expiring Soon</h2>
        <p id="statExpiring" class="stat-value">0</p>
      </article>
      <article class="card stat">
        <h2 data-i18n="stat_expired">Expired</h2>
        <p id="statExpired" class="stat-value">0</p>
      </article>
    </section>

    <section class="grid two-col advanced-only" data-app-screen="home">
      <article class="card">
        <h2 data-i18n="add_item_title">Add Inventory Item</h2>
        <form id="createItemForm" class="form">
          <label>
            <span data-i18n="label_ingredient">Ingredient</span>
            <input name="ingredient_name" placeholder="milk" data-i18n-placeholder="ph_ingredient_example" required>
          </label>
          <label>
            <span data-i18n="label_purchased_date">Purchased Date</span>
            <input name="purchased_at" type="date" required>
          </label>
          <label>
            <span data-i18n="label_storage_type">Storage Type</span>
            <select name="storage_type">
              <option value="refrigerated" data-i18n="storage_refrigerated">refrigerated</option>
              <option value="frozen" data-i18n="storage_frozen">frozen</option>
              <option value="room" data-i18n="storage_room">room</option>
            </select>
          </label>
          <div class="inline-fields">
            <label>
              <span data-i18n="label_quantity">Quantity</span>
              <input name="quantity" type="number" min="1" step="1" inputmode="numeric" value="1">
            </label>
            <label>
              <span data-i18n="label_unit">Unit</span>
              <input name="unit" value="ea">
            </label>
          </div>
          <label>
            <span data-i18n="label_ocr_raw_text">OCR Raw Text (optional)</span>
            <input name="ocr_raw_text" placeholder="BEST BEFORE 2026-03-20" data-i18n-placeholder="ph_ocr_example">
          </label>
          <label>
            <span data-i18n="label_product_shelf_life_days">Product Shelf-Life Days (optional)</span>
            <input name="product_shelf_life_days" type="number" min="1">
          </label>
          <button type="submit" class="btn" data-i18n="btn_save_item">Save Item</button>
        </form>
      </article>

      <article class="card">
        <h2 data-i18n="notification_runner_title">Notification Runner</h2>
        <p data-i18n="notification_runner_desc">Send all due notifications up to now.</p>
        <button id="runDueBtn" class="btn secondary" type="button" data-i18n="btn_run_due_notifications">Run Due Notifications</button>
        <div id="runDueResult" class="muted"></div>
      </article>
    </section>

    <section class="grid two-col" data-app-screen="capture">
      <article class="card" id="captureCard">
        <h2 data-i18n="conversational_capture_title">Conversational Capture</h2>
        <div class="form">
          <div class="inline-fields easy-only">
            <div class="segmented" id="captureStorageButtons" role="group" aria-label="Storage type">
              <button type="button" class="seg-btn" data-storage="refrigerated" data-i18n="storage_refrigerated">refrigerated</button>
              <button type="button" class="seg-btn" data-storage="frozen" data-i18n="storage_frozen">frozen</button>
              <button type="button" class="seg-btn" data-storage="room" data-i18n="storage_room">room</button>
            </div>
          </div>
          <div class="inline-fields advanced-only">
            <label>
              <span data-i18n="label_session_id">Session ID</span>
              <input id="captureSessionId" type="text" readonly placeholder="Start a session" data-i18n-placeholder="ph_start_session">
            </label>
            <label>
              &nbsp;
              <button id="startCaptureSessionBtn" class="btn" type="button" data-i18n="btn_start_session">Start Session</button>
            </label>
          </div>
          <div class="inline-fields advanced-only">
            <label>
              <span data-i18n="label_storage_type">Storage Type</span>
              <select id="captureStorageType">
                <option value="refrigerated" data-i18n="storage_refrigerated">refrigerated</option>
                <option value="frozen" data-i18n="storage_frozen">frozen</option>
                <option value="room" data-i18n="storage_room">room</option>
              </select>
            </label>
          </div>
          <p class="muted advanced-only" data-i18n="capture_storage_help">Applies when finalizing to inventory.</p>
          <div class="quick-actions easy-only">
            <label for="captureVisionImageInput" class="btn big full" data-i18n="btn_take_photo">Take Photo</label>
            <button id="quickTalkBtn" class="btn big secondary full" type="button" data-i18n="btn_quick_talk">Talk</button>
          </div>
          <p class="muted easy-only" data-i18n="quick_capture_hint">Choose storage, then take a photo or talk. We'll add items automatically.</p>
          <p id="quickTalkStatus" class="muted easy-only" aria-live="polite"></p>
          <label class="advanced-only">
            <span data-i18n="label_voice_text_message">Voice/Text Message</span>
            <textarea id="captureMessageInput" rows="3" placeholder="This is tofu. This is kimchi. This is bacon. This is egg." data-i18n-placeholder="ph_capture_message_example"></textarea>
          </label>
          <label class="advanced-only">
            <span data-i18n="label_vision_items">Vision Items (comma separated, optional)</span>
            <input id="captureVisionItemsInput" type="text" placeholder="tofu, kimchi" data-i18n-placeholder="ph_vision_items_example">
          </label>
          <input id="captureVisionImageInput" class="sr-only" type="file" accept="image/*" capture="environment">
          <div class="inline-fields advanced-only">
            <label for="captureVisionImageInput" class="file-picker">
              <span data-i18n="label_vision_image">Vision Image (optional)</span>
              <span id="captureVisionFileName" class="muted file-name"></span>
            </label>
            <label>
              <span data-i18n="label_segmentation">Segmentation</span>
              <select id="captureSegmentationMode">
                <option value="auto" selected data-i18n="seg_auto">auto (SAM3 if configured)</option>
                <option value="none" data-i18n="seg_none">none (full image)</option>
                <option value="sam3_http" data-i18n="seg_sam3_http">sam3_http (require endpoint)</option>
              </select>
            </label>
          </div>
          <div class="inline-actions advanced-only">
            <button id="analyzeVisionImageBtn" class="btn ghost" type="button" data-i18n="btn_analyze_image">Analyze Image</button>
          </div>
          <div id="visionAnalyzeMeta" class="muted"></div>
          <div id="visionObjectPanel" class="vision-object-panel" hidden>
            <h3 class="subhead" data-i18n="vision_objects_title">Object Labels</h3>
            <p id="visionObjectHint" class="muted" data-i18n="vision_objects_hint">Tap a box to select. Edit labels if needed.</p>
            <div class="inline-actions vision-object-actions">
              <button id="visionAddBoxBtn" class="btn ghost" type="button" data-i18n="btn_add_box">Add Box</button>
              <button id="visionDeleteBoxBtn" class="btn warn" type="button" data-i18n="btn_delete_box">Delete</button>
            </div>
            <div class="vision-stage" id="visionStage">
              <img id="visionPreviewImage" alt="" loading="lazy">
              <canvas id="visionPreviewCanvas"></canvas>
              <div id="visionInlineEditor" class="vision-inline-editor" hidden>
                <input id="visionInlineInput" type="text" autocomplete="off">
                <div class="vision-inline-actions">
                  <button id="visionInlineSaveBtn" type="button" class="btn tiny secondary" data-i18n="btn_save_label">Save</button>
                  <button id="visionInlineCancelBtn" type="button" class="btn tiny ghost" data-i18n="btn_cancel_label">Cancel</button>
                </div>
              </div>
            </div>
          </div>
           <details class="camera-details advanced-only">
             <summary data-i18n="live_camera_summary">Live Camera (experimental)</summary>
             <div class="camera-panel">
               <video id="liveCameraVideo" class="camera-video" autoplay playsinline muted></video>
               <div class="inline-actions">
                 <button id="startCameraBtn" class="btn ghost" type="button" data-i18n="btn_start_camera">Start Camera</button>
                 <button id="stopCameraBtn" class="btn ghost" type="button" data-i18n="btn_stop_camera">Stop Camera</button>
                 <button id="captureFrameBtn" class="btn ghost" type="button" data-i18n="btn_capture_frame">Capture Frame</button>
               </div>
               <div class="inline-fields camera-fields">
                 <label>
                   <span data-i18n="label_facing">Facing</span>
                   <select id="cameraFacingMode">
                     <option value="environment" selected data-i18n="facing_back">back</option>
                     <option value="user" data-i18n="facing_front">front</option>
                   </select>
                 </label>
                 <label>
                   <span data-i18n="label_auto_capture">Auto Capture</span>
                   <select id="cameraAutoInterval">
                     <option value="0" selected data-i18n="auto_off">off</option>
                     <option value="1500">1.5s</option>
                     <option value="2000">2s</option>
                     <option value="3000">3s</option>
                     <option value="5000">5s</option>
                   </select>
                 </label>
               </div>
               <div id="cameraStatus" class="muted"></div>
             </div>
           </details>
           <details class="realtime-details advanced-only">
             <summary data-i18n="realtime_summary">Realtime Voice Agent (hybrid)</summary>
             <div class="realtime-panel">
               <div class="inline-actions">
                 <button id="startRealtimeBtn" class="btn ghost" type="button" data-i18n="btn_start_voice">Start Voice</button>
                 <button id="stopRealtimeBtn" class="btn ghost" type="button" disabled data-i18n="btn_stop_voice">Stop Voice</button>
               </div>
               <div class="inline-fields realtime-fields">
                 <label class="checkline">
                   <input id="realtimeAutoIngestSpeech" type="checkbox" checked>
                   <span data-i18n="realtime_auto_ingest">Auto-add my speech to draft</span>
                 </label>
                 <label class="checkline">
                   <input id="realtimeShareVision" type="checkbox" checked>
                   <span data-i18n="realtime_share_snapshots">Share snapshots (images) to agent</span>
                 </label>
               </div>
               <label>
                 <span data-i18n="label_send_text_optional">Send Text (optional)</span>
                 <input id="realtimeTextInput" type="text" placeholder="What can I cook with what you see?" data-i18n-placeholder="ph_realtime_text_example">
               </label>
               <div class="inline-actions">
                 <button id="sendRealtimeTextBtn" class="btn secondary tiny" type="button" data-i18n="btn_send_to_agent">Send To Agent</button>
               </div>
               <audio id="realtimeAudio" autoplay></audio>
               <div id="realtimeStatus" class="muted"></div>
               <div id="realtimeLog" class="realtime-log" aria-live="polite"></div>
             </div>
            </details>
           <div class="inline-actions">
             <button id="sendCaptureMessageBtn" class="btn advanced-only" type="button" data-i18n="btn_send_message">Send Message</button>
             <button id="undoCaptureBtn" class="btn ghost" type="button" data-i18n="btn_undo_last">Undo Last</button>
             <button id="finalizeCaptureBtn" class="btn big secondary full" type="button" data-i18n="btn_finalize_to_inventory">Finalize To Inventory</button>
           </div>
          <div id="captureError" class="error-inline" hidden></div>
          <div id="captureMeta" class="muted"></div>
        </div>
      </article>
      <article class="card" id="captureDraftCard">
        <h2 data-i18n="capture_draft_title">Capture Draft</h2>
        <div id="captureDraftList" class="list"></div>
        <h3 class="subhead" data-i18n="pending_confirmations_title">Pending Confirmations (Session)</h3>
        <div id="captureReviewList" class="list"></div>
      </article>
    </section>

    <section class="grid one-col advanced-only" data-app-screen="capture">
      <article class="card">
        <div class="section-head">
          <h2 data-i18n="ingredient_review_queue_title">Ingredient Review Queue</h2>
          <button id="reloadReviewQueueBtn" class="btn ghost" type="button" data-i18n="btn_reload">Reload</button>
        </div>
        <p class="muted" data-i18n="review_queue_desc">Unknown or low-confidence ingredients appear here. Confirm once and the parser learns it.</p>
        <div id="reviewQueueList" class="list"></div>
      </article>
    </section>

    <section class="grid two-col" data-app-screen="inventory recipes">
      <article class="card" id="inventoryCard" data-app-screen="inventory">
        <div class="section-head">
          <h2 data-i18n="inventory_title">Inventory</h2>
          <button id="reloadInventoryBtn" class="btn ghost" type="button" data-i18n="btn_reload">Reload</button>
        </div>
        <div class="segmented inventory-tabs" id="inventoryTabs" role="tablist" aria-label="Inventory storage filter">
          <button type="button" class="seg-btn" data-storage="refrigerated" data-i18n="storage_refrigerated">refrigerated</button>
          <button type="button" class="seg-btn" data-storage="frozen" data-i18n="storage_frozen">frozen</button>
          <button type="button" class="seg-btn" data-storage="room" data-i18n="storage_room">room</button>
        </div>
        <div id="inventoryBulkBar" class="bulk-bar" aria-label="Inventory bulk actions">
          <label class="checkline bulk-check">
            <input id="inventorySelectAll" type="checkbox">
            <span data-i18n="btn_select_all">Select all</span>
          </label>
          <span id="inventorySelectedCount" class="muted"></span>
          <div class="bulk-actions">
            <div class="qty-stepper bulk-stepper" aria-label="Selected quantity adjust">
              <button id="inventoryBulkConsumeBtn" class="btn tiny warn" type="button" aria-label="Decrease quantity">-</button>
              <span class="qty-value">1</span>
              <button id="inventoryBulkAddBtn" class="btn tiny" type="button" aria-label="Increase quantity">+</button>
            </div>
            <button id="inventoryBulkClearBtn" class="btn tiny ghost" type="button" data-i18n="btn_clear_selection">Clear</button>
          </div>
        </div>
        <div id="inventoryList" class="list"></div>
      </article>

      <article class="card" id="recipesCard" data-app-screen="recipes">
        <div class="section-head">
          <h2 data-i18n="recipes_title">Recipe Recommendations</h2>
          <button id="reloadRecipesBtn" class="btn ghost" type="button" data-i18n="btn_reload">Reload</button>
        </div>
        <div id="recipeList" class="list"></div>
      </article>
    </section>

    <section class="grid one-col" data-app-screen="alerts">
      <article class="card" id="expiringCard">
        <div class="section-head">
          <h2 data-i18n="expiring_focus_title">Expiring Items (All Storage)</h2>
          <button id="reloadExpiringFocusBtn" class="btn ghost" type="button" data-i18n="btn_reload">Reload</button>
        </div>
        <p class="muted" data-i18n="expiring_focus_desc">Shows items nearing expiration across refrigerated/frozen/room.</p>
        <div id="expiringFocusList" class="list"></div>
      </article>
    </section>

    <section class="grid two-col" data-app-screen="shopping alerts">
      <article class="card" id="shoppingCard" data-app-screen="shopping">
        <div class="section-head">
          <h2 data-i18n="shopping_title">Shopping Suggestions</h2>
          <div class="inline-actions">
            <button id="toggleShoppingAutoFilterBtn" class="btn ghost" type="button" data-i18n="btn_shopping_auto_only">Auto-Order Only</button>
            <button id="createOrderDraftBtn" class="btn secondary" type="button" data-i18n="btn_create_order_draft">Create Order Draft</button>
            <button id="reloadShoppingBtn" class="btn ghost" type="button" data-i18n="btn_reload">Reload</button>
          </div>
        </div>
        <div id="shoppingList" class="list"></div>
        <div id="shoppingDraftResult" class="muted"></div>
      </article>

      <article class="card" id="notificationsCard" data-app-screen="alerts">
        <div class="section-head">
          <h2 data-i18n="notifications_title">Notifications</h2>
          <button id="reloadNotificationsBtn" class="btn ghost" type="button" data-i18n="btn_reload">Reload</button>
        </div>
        <p class="muted" data-i18n="notifications_pref_desc">Choose how many days before expiration to alert.</p>
        <div id="notificationLeadButtons" class="inline-actions notification-lead-buttons"></div>
        <div class="inline-fields notification-pref-fields">
          <label>
            <span data-i18n="label_notification_day">Day</span>
            <input id="notificationLeadInput" type="number" min="0" max="60" placeholder="7">
          </label>
          <label>
            &nbsp;
            <button id="notificationLeadAddBtn" class="btn ghost" type="button" data-i18n="btn_add_day">Add Day</button>
          </label>
        </div>
        <div class="inline-actions">
          <button id="saveNotificationPrefsBtn" class="btn secondary" type="button" data-i18n="btn_save_notification_prefs">Save Alert Rule</button>
        </div>
        <div id="notificationPrefsMeta" class="muted"></div>
        <div id="notificationList" class="list"></div>
      </article>
    </section>

    <nav class="app-bottom-nav" id="appBottomNav" aria-label="App navigation">
      <button id="navAlertsBtn" class="app-nav-btn" type="button" data-screen="alerts">
        <span aria-hidden="true">&#9200;</span>
        <small>유통기한 알림</small>
      </button>
      <button id="navRecipesBtn" class="app-nav-btn" type="button" data-screen="recipes">
        <span aria-hidden="true">&#127859;</span>
        <small>레시피 추천</small>
      </button>
      <button id="navShoppingBtn" class="app-nav-btn" type="button" data-screen="shopping">
        <span aria-hidden="true">&#128722;</span>
        <small>쇼핑 연결</small>
      </button>
    </nav>
  </main>

  <template id="inventoryItemTemplate">
    <div class="item inventory-item">
      <div class="item-main">
        <div class="inventory-title-row">
          <input class="inventory-select" type="checkbox" aria-label="Select inventory item">
          <strong class="name"></strong>
        </div>
        <span class="meta"></span>
      </div>
      <div class="item-side">
        <span class="badge"></span>
        <div class="qty-stepper item-qty-stepper" aria-label="Item quantity adjust">
          <button class="btn tiny warn qty-minus-btn" type="button" aria-label="Decrease quantity">-</button>
          <input
            class="qty-input"
            type="number"
            min="0"
            step="1"
            inputmode="numeric"
            value="0"
            aria-label="Set quantity">
          <button class="btn tiny qty-plus-btn" type="button" aria-label="Increase quantity">+</button>
        </div>
      </div>
    </div>
  </template>

  <script src="/app.js"></script>
</body>
</html>

