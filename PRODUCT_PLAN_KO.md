# 냉장고 식자재 인식 앱 MVP 기획안

## 1) 목표 정리
당장의 목표(MVP)는 아래 4가지입니다.
1. **식자재 자동 인식/리스트업**: 사용자가 냉장고 사진을 업로드하면 품목을 자동 추출
2. **유통기한 관리**: 품목별 평균 보관일/유통기한을 계산해 저장
3. **만기 알림**: 만료 임박/만료 당일 푸시 알림
4. **재료 기반 요리 추천**: 현재 냉장고 재료로 만들 수 있는 레시피 제안

---

## 2) MVP 기능 범위 (현실적인 1차)

### A. 사진 등록 및 식자재 인식
- 입력: 카메라 촬영 / 갤러리 업로드
- 처리:
  - 객체 탐지(Object Detection)로 식재료 후보 추출
  - OCR로 라벨(브랜드/유통기한) 보조 인식
  - 사용자 확인 UI(“이게 맞나요?”)로 최종 확정
- 출력: `식재료명`, `수량`, `추정 신선도`, `등록일`

> 핵심: 완전 자동보다 **반자동(사용자 확인)** 으로 정확도를 빠르게 끌어올리는 것이 초기 성공에 유리합니다.

### B. 냉장고 인벤토리
- 품목 리스트(카테고리/정렬/검색)
- 상태 뱃지: `여유`, `임박`, `만료`
- 빠른 액션: 수량 수정, 소비 처리, 삭제

### C. 유통기한/보관기한 로직
- 우선순위:
  1. OCR로 실제 표기 유통기한 인식 시 그 값을 최우선 사용
  2. 없으면 품목별 평균 보관기한 DB 사용(냉장/냉동/실온 조건 포함)
- 사용자 조정 가능(실제 보관 상태 반영)

### D. 알림
- D-3 / D-1 / D-day 푸시
- 알림 탭에서 “오늘 빨리 먹어야 할 재료” 모아보기
- 알림 클릭 시 바로 레시피 추천 화면 이동

### E. 재료 기반 레시피 추천
- 현재 보유 재료 매칭률 기반 추천(예: 80% 이상 재료 보유)
- 임박 재료 가중치(빨리 소진해야 할 재료 포함 레시피 우선)
- 부족 재료 최소화 필터

---

## 3) 추천 기술 구조

## 모바일 앱
- **Flutter** 또는 **React Native** (개발 속도/크로스플랫폼)

## 백엔드 API
- **FastAPI** 또는 **NestJS**
- 기능: 사용자/인벤토리/레시피/알림 스케줄

## AI 인식
- 1차:
  - 이미지 인식 API(클라우드 비전) + 커스텀 라벨링
  - OCR API 연동(유통기한 표기 추출)
- 2차:
  - 자체 모델 파인튜닝(냉장고 환경 데이터셋 축적 후)

## 데이터 저장
- PostgreSQL: 사용자/재료/이력
- Redis(옵션): 알림 큐/캐시
- Object Storage: 이미지 원본

## 알림
- FCM/APNs 푸시
- 배치 작업(Cron/큐 워커)으로 임박 품목 계산

---

## 4) 핵심 데이터 모델 (초안)

### `ingredients`
- id
- user_id
- name
- category
- quantity
- unit
- detected_at
- expires_at
- expiry_source (`ocr`, `default_db`, `manual`)
- freshness_score
- image_id

### `ingredient_history`
- id
- ingredient_id
- action (`add`, `update`, `consume`, `discard`)
- changed_at

### `recipes`
- id
- title
- tags
- chef_id (향후 협업 대비)
- ingredients_required (json)

### `recipe_recommendations`
- id
- user_id
- recipe_id
- match_score
- missing_ingredients
- created_at

---

## 5) 개발 단계 제안 (8주 예시)

### 1~2주차: 기반 구축
- 인증/온보딩
- 인벤토리 CRUD
- 기본 UI

### 3~4주차: 이미지 인식 MVP
- 사진 업로드
- 객체탐지 + OCR 연동
- 사용자 확인/수정 플로우

### 5주차: 유통기한 엔진
- 기본 보관기한 DB
- expires_at 계산 로직
- 상태 뱃지/정렬

### 6주차: 알림
- 만기 임박 배치
- 푸시 전송
- 알림 탭 구현

### 7주차: 레시피 추천
- 매칭 스코어 알고리즘
- 임박 재료 우선 추천

### 8주차: QA/런칭 준비
- 정확도 점검(인식/만기 계산)
- 알림 신뢰성 테스트
- 앱 배포 준비

---

## 6) 성공 지표(KPI)
- 인식 정확도 Top-1: 1차 목표 75%+
- 사용자 수정률: 30% 이하(낮을수록 좋음)
- 주간 활성 사용자(WAU)
- 만기 폐기율 감소율(앱 사용 전/후 비교)
- 추천 레시피 클릭률/조리완료율

---

## 7) 미래 확장 로드맵
1. **자동 장보기 연동**
   - 소진 패턴 기반 자동 구매 제안
   - 쿠팡/마켓 API 또는 제휴몰 장바구니 연동
2. **셰프 콜라보 레시피**
   - “내 냉장고로 가능한 셰프 레시피” 큐레이션
   - 프리미엄 구독 기능으로 확장 가능
3. **가구 단위 최적화**
   - 가족 구성원 선호/알레르기 반영
   - 식단 계획 + 재고 자동 동기화

---

## 8) 바로 실행할 우선순위 (Action Items)
1. MVP 스코프 동결(위 4개 핵심 기능)
2. 인식 PoC 진행(실제 냉장고 사진 200~500장으로 정확도 검증)
3. 품목별 평균 보관기한 DB 구축(초기 100개 품목)
4. 인벤토리/알림 UX 와이어프레임 확정
5. 8주 개발 일정으로 베타 출시 목표 설정

이 순서로 시작하면, 먼 미래 비전(자동 주문/셰프 협업)까지 자연스럽게 확장 가능한 구조를 만들 수 있습니다.

---

## 9) SAM 오픈소스 사용 가능성 (질문 반영)

### 결론 요약
- **가능은 하지만, SAM 단독은 비추천**입니다.
- 이유: SAM 계열 모델은 “무엇이 물체인지 분할”에는 강하지만, **그 물체가 어떤 식자재인지 분류**하는 능력은 별도 모델이 필요합니다.

### 실무 권장 구조
1. **탐지/분할**: SAM 계열(또는 YOLO 계열)로 재료 영역 추출
2. **분류**: 추출된 영역을 식자재 분류 모델(CNN/ViT 또는 멀티모달 API)로 라벨링
3. **텍스트 인식**: OCR로 유통기한/라벨 읽기
4. **사용자 검수**: 초기에 꼭 확인 UI 넣어 오인식 보정

### 왜 단독 비추천인가?
- 냉장고 내부는 가림(occlusion), 반사, 비슷한 외형(양파/감자, 소스병 등) 때문에 **분할만으로 품목 판별이 어렵습니다.**
- 실제 서비스 KPI(정확도/수정률)를 맞추려면 분류+OCR+사용자 피드백 루프가 필요합니다.

### MVP에서의 현실적 추천
- 1차는 **클라우드 비전 API + OCR + 사용자 확인**으로 빠르게 출시
- 동시에 데이터 축적
- 2차에서 SAM 계열 포함한 자체 파이프라인(분할+분류)로 비용/정확도 최적화

> 참고: SAM의 차기 버전/파생 구현은 계속 나오고 있어도, 제품 관점에서는 “세그멘테이션 + 분류 + OCR + 검수” 조합으로 설계하는 것이 안정적입니다.

---

## 10) 카메라 실시간 인식 + 대화형 UX 가능 여부 (모바일/웨어러블)

### 결론
- **가능합니다.**
- 다만 사진 업로드 방식과 달리, 실시간 방식은 지연시간(latency), 배터리, 발열, 네트워크 품질을 고려한 설계가 필요합니다.

### 구현 방식 (권장)
1. **디바이스 카메라 스트림 수집**
   - 모바일: 카메라 프리뷰 프레임을 주기적으로 샘플링(예: 1~2fps)
   - 웨어러블(스마트 글래스): 저해상도+저프레임 우선으로 배터리 최적화
2. **실시간 비전 추론 파이프라인**
   - 온디바이스 경량 모델(1차 필터) + 서버 비전 API(정밀 판별) 하이브리드
   - 프레임 전체 매번 분석하지 않고 ROI(관심영역) 중심 추론
3. **대화형 오케스트레이션**
   - 음성 인식(STT) + LLM + 비전 결과 결합
   - 예: “지금 유통기한 임박한 거 뭐야?” → 현재 인식 결과+DB 조합 응답
4. **결과 확정 UX**
   - “토마토 3개로 인식했어요. 맞나요?” 같은 짧은 확인 루프
   - 실시간 인식값은 임시 상태, 사용자 확인 시 인벤토리 확정 저장

### 모바일에서 바로 가능한 시나리오
- 사용자가 냉장고 앞에서 카메라를 켠 상태로 음성 질의
- 시스템이 현재 보이는 재료를 계속 업데이트
- 질문 예시:
  - “오늘 바로 먹어야 하는 거 보여줘”
  - “지금 있는 재료로 15분 안에 가능한 요리 추천해줘”
  - “우유가 없으면 장보기 목록에 추가해줘”

### 웨어러블(메타 글래스류) 확장 시 고려사항
- **입력 UX**: 음성 중심(핸즈프리), 짧은 확인 대화 필수
- **전력 제약**: 온디바이스 모델은 초경량, 정밀 판단은 서버 오프로딩
- **네트워크**: 오프라인/저품질 네트워크 대비 캐시·지연 허용 UX 필요
- **프라이버시**: 상시 카메라에 대한 명확한 동의/표시(LED/아이콘), 민감 구역 마스킹

### MVP → 확장 단계 제안
- 1단계(MVP): 사진 업로드 + 반자동 확인
- 2단계: 모바일 실시간 스캔 모드(짧은 세션 기반)
- 3단계: 음성 대화 결합(“냉장고 코파일럿”)
- 4단계: 웨어러블 연동(핸즈프리 재고 점검/레시피 안내)

### 기술적으로 중요한 포인트
- 실시간은 “항상 정확”보다 **빠른 반응 + 사용자 확인**이 핵심
- 프레임 단위 단발 인식보다, 시간축 추적(Tracking)으로 안정화 필요
- 인벤토리 DB는 이벤트 소싱 방식(추가/소비/수정 이력)으로 신뢰성 확보

이 구조로 가면, 지금의 MVP(식자재 인식·유통기한·알림)에서 시작해도 나중에 모바일 실시간 대화형 UX와 웨어러블까지 자연스럽게 확장할 수 있습니다.

---

## 11) 그래서 지금 어디서부터 시작할지 (바로 실행용)

“이대로 개발 진행”을 기준으로, **오늘 바로 시작할 순서**를 아래처럼 고정하면 됩니다.

### Step 0. 팀/역할 최소 셋업 (반나절)
- 역할: PM 1, 모바일 1, 백엔드 1, AI 1 (겸업 가능)
- 공통 툴: 이슈 트래커(Linear/Jira), 디자인(Figma), API 문서(Swagger/Notion)
- 결정사항 3개만 먼저 확정
  1. 모바일 스택(Flutter vs React Native)
  2. 백엔드 스택(FastAPI vs NestJS)
  3. 1차 비전 공급자(클라우드 비전/OCR)

### Step 1. MVP 요구사항 동결 (1일)
- 반드시 이번 배포에 넣을 것:
  - 식자재 인식/리스트업
  - 유통기한 계산/상태 뱃지
  - 만기 알림(D-3/D-1/D-day)
  - 재료 기반 레시피 추천(매칭률 기반)
- 이번 배포에서 제외할 것:
  - 자동 주문 연동
  - 셰프 콜라보/프리미엄 기능

### Step 2. 데이터/도메인 먼저 구현 (2~3일)
- DB 테이블 우선 구현: `ingredients`, `ingredient_history`, `recipes`, `recipe_recommendations`
- 핵심 API부터 생성
  - `POST /ingredients/detect` (이미지 업로드 후 후보 반환)
  - `POST /ingredients/confirm` (사용자 확정 저장)
  - `GET /ingredients` (리스트/상태)
  - `GET /recipes/recommendations` (매칭 점수 기반)
- 이 단계 목표: **앱 UI 없이도 Postman으로 전체 흐름 검증 가능 상태**

### Step 3. 인식 PoC를 가장 먼저 검증 (병렬 1주)
- 실제 냉장고 사진 200~500장 수집(조명/각도/가림 다양화)
- 측정 지표
  - Top-1 정확도
  - 사용자 수정률
  - 처리 지연시간(업로드→결과)
- 기준 미달 시 즉시 보완
  - 품목 라벨 통합(동의어 정리)
  - 사용자 확인 UX 강화
  - OCR 후처리 룰(날짜 포맷 정규화)

### Step 4. 앱 화면은 3개부터 (1주)
1. 인벤토리 리스트 화면
2. 사진 업로드/인식 확인 화면
3. 임박 알림/추천 화면

> 포인트: 화면을 많이 만들기보다, “촬영→확정→알림→추천” 한 사이클을 먼저 완성하세요.

### Step 5. 만기 알림 배치 붙이기 (2~3일)
- 매일 1~2회 배치 실행 + 푸시 발송
- 오탐 방지 규칙
  - 이미 소비/폐기한 품목 제외
  - 같은 품목 중복 알림 제한(쿨다운)

### Step 6. 베타 기준선(Go/No-Go) 정의 (출시 전)
- 인식 정확도 75%+
- 사용자 수정률 30% 이하
- 알림 실패율 허용치 정의(예: 1% 미만)
- 크래시율/응답속도 최소 기준

---

## 12) 첫 2주 스프린트 백로그 예시

### Week 1
- [BE] 인벤토리/히스토리 CRUD + 상태 계산
- [AI] Vision + OCR 연동 API 래핑
- [App] 인벤토리 리스트/상세 UI
- [PM/Design] 인식 확인 플로우 확정

### Week 2
- [BE] detect/confirm API + 추천 API 초안
- [AI] PoC 정확도 리포트 1차
- [App] 사진 업로드 + 인식 결과 확인/수정
- [All] E2E 시나리오 테스트(촬영→저장→알림)

이 백로그대로 진행하면, 2주 내 “작동하는 뼈대”를 만들고 3~8주차에 정확도/알림/추천 품질을 올리는 방식으로 안정적으로 갈 수 있습니다.
